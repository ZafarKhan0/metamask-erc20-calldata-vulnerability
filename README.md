# MetaMask ERC-20 Calldata Vulnerability

## Overview
This repository details a critical vulnerability I discovered in MetaMask when interacting with ERC-20 tokens compiled using Solidity versions below 0.5.0. The vulnerability exploits leniency in input calldata length validation, allowing malicious actors to craft deceptive transactions. The discovery was acknowledged and rewarded with a $1000 bounty as part of the MetaMask bug bounty program on HackerOne.

##Introduction
This project investigates and demonstrates a vulnerability in MetaMask when interacting with ERC-20 tokens compiled with previous versions of Solidity. The issue lies in how these versions handle calldata length, potentially leading to misleading transactions and unauthorized token transfers. This repository provides a detailed analysis, proof of concept, and mitigation strategies for this vulnerability.

## Vulnerability Details
##  Background
Solidity is the primary language for writing smart contracts on Ethereum. Each function call requires specific calldata structure, including the function signature (sighash) and parameters. In versions below 0.5.0, the Solidity compiler does not enforce strict checks on calldata length, allowing for potentially harmful transactions to pass unnoticed.

##  Exploitation
Malicious actors can craft transactions with truncated or malformed calldata, which older Solidity versions will still interpret as valid. This can lead to misleading transaction prompts in MetaMask, causing users to inadvertently authorize harmful actions.

## Impact
##  User Deception
Phishing Attack Potential: Attackers can create phishing websites that initiate malformed transactions. Users may see transaction prompts lacking critical details like the transfer amount or recipient address.
Incomplete Transaction Prompts: MetaMask’s failure to parse malformed calldata properly can mislead users into authorizing transactions without fully understanding their implications.

##  Loss of Funds
Unauthorized Transfers: Users may unknowingly approve transactions transferring tokens to attackers' addresses.
Unintended Approvals: Attackers can gain approval for token transfers, allowing them to withdraw tokens from the user’s wallet later.

## Proof of Concept

##  Setup
    -Solidity Compiler: Version 0.4.26
    -Ethereum Development Environment: Truffle or Hardhat
    -Test Ethereum Network
    -MetaMask Wallet

## Exploit Execution
    -Deploy a vulnerable ERC-20 token contract using Solidity 0.4.26.
    -Use the malicious_transaction.py script to craft a truncated transaction.

## Mitigation

## To protect against this vulnerability, users and developers should:
    -Update Solidity Compiler: Ensure all smart contracts are compiled with Solidity 0.5.0 or later.
    -Review Transactions Carefully: Users should closely inspect transaction details in MetaMask, especially when using dApps or websites they are not familiar with.

## Skills Utilized
    -Blockchain Security: Identified and analyzed vulnerabilities within smart contracts.
    -Solidity: Utilized knowledge of Solidity and Ethereum to understand and exploit the vulnerability.
    -Web3.py: Used for scripting and interaction with Ethereum blockchain.
    -Smart Contract Development: Experience with deploying and testing smart contracts.
    -Penetration Testing: Conducted thorough testing and proof of concept to demonstrate the vulnerability.

## Acknowledgments
I would like to thank the MetaMask team and the HackerOne community for their support and the opportunity to contribute to the security of the blockchain ecosystem.
